<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Store |
	webda.io - vundefined</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../../assets/css/main.css">
	<script async src="../../assets/js/search.js" id="search-script"></script>
</head>
<body>
<div class="main">
	<header>
		<div class="tsd-page-toolbar">
			<div class="container">
				<div class="table-wrap">
					<div class="table-cell" id="tsd-search" data-index="../../assets/js/search.json"
					data-base="../..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<ul class="results-priority" style="display:none">
					</ul>
					<div class="topMenu">
						<a href="../../index.html" class="title">webda.io - vundefined</a>
						<div class="links">
						</div>
					</div>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
</div>
<div class="tsd-page-title">
	<div class="container">
		<ul class="tsd-breadcrumb">
			<li>
				<a href="../Concepts.html">Concepts</a>
			</li>
			<li>
				<a href="Stores.html">Store</a>
			</li>
		</ul>
	</div>
</div>
</header>        <div class="container container-main">
	<div class="row">
		<div class="col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation root">
				<ul>
					<li class=" pp-nav pp-page pp-depth-0 pp-active root">
						<a href="../Concepts.html" class="tsd-kind-icon">Concepts</a>
					</li>
					<li class=" pp-nav pp-page pp-depth-1 root">
						<a href="Authentication.html" class="tsd-kind-icon">Authentication</a>
					</li>
					<li class=" pp-nav pp-page pp-depth-1 root">
						<a href="Binary.html" class="tsd-kind-icon">Binary</a>
					</li>
					<li class=" pp-nav pp-page pp-depth-1 root">
						<a href="ConfigurationService.html" class="tsd-kind-icon">Configuration <wbr>Service</a>
					</li>
					<li class=" pp-nav pp-page pp-depth-1 root">
						<a href="Events.html" class="tsd-kind-icon">Events</a>
					</li>
					<li class=" pp-nav pp-page pp-depth-1 root">
						<a href="ExtendingShell.html" class="tsd-kind-icon">Extending webda executable</a>
					</li>
					<li class=" pp-nav pp-page pp-depth-1 root">
						<a href="Services.html" class="tsd-kind-icon">Services</a>
					</li>
				</ul>
				<ul class="current">
					<li class="current pp-nav pp-page pp-depth-1 root">
						<a href="Stores.html" class="tsd-kind-icon">Store</a>
					</li>
				</ul>
				<ul class="after-current">
					<li class=" pp-nav pp-page pp-depth-1 root">
						<a href="Webda.config.json.html" class="tsd-kind-icon">webda.config.json</a>
					</li>
					<li class=" pp-nav pp-page pp-depth-0 root">
						<a href="../Deployments.html" class="tsd-kind-icon">Deployments</a>
					</li>
					<li class=" pp-nav pp-page pp-depth-0 root">
						<a href="../Migration.html" class="tsd-kind-icon">Migration</a>
					</li>
					<li class=" pp-nav pp-page pp-depth-0 root">
						<a href="../QuickStart.html" class="tsd-kind-icon">Quick <wbr>Start</a>
					</li>
					<li class=" pp-nav pp-page pp-depth-0 root">
						<a href="../Security.html" class="tsd-kind-icon">Security</a>
					</li>
					<li class=" pp-nav pp-group root">
						<a href="" class="tsd-kind-icon">Modules</a>
					</li>
					<li class="  root">
						<a href="../../modules.html" class="tsd-kind-icon">Modules</a>
					</li>
					<li class=" tsd-kind-module root">
						<a href="../../modules/_webda_aws.html" class="tsd-kind-icon">@webda/aws</a>
					</li>
					<li class=" tsd-kind-module root">
						<a href="../../modules/_webda_core.html" class="tsd-kind-icon">@webda/core</a>
					</li>
					<li class=" tsd-kind-module root">
						<a href="../../modules/_webda_elasticsearch.html" class="tsd-kind-icon">@webda/elasticsearch</a>
					</li>
					<li class=" tsd-kind-module root">
						<a href="../../modules/_webda_google_auth.html" class="tsd-kind-icon">@webda/google-<wbr>auth</a>
					</li>
					<li class=" tsd-kind-module root">
						<a href="../../modules/_webda_profiler.html" class="tsd-kind-icon">@webda/profiler</a>
					</li>
					<li class=" tsd-kind-module root">
						<a href="../../modules/_webda_profiler_aws_xray.html" class="tsd-kind-icon">@webda/profiler-<wbr>aws-<wbr>xray</a>
					</li>
					<li class=" tsd-kind-module root">
						<a href="../../modules/_webda_shell.html" class="tsd-kind-icon">@webda/shell</a>
					</li>
					<li class=" tsd-kind-module root">
						<a href="../../modules/_webda_workout.html" class="tsd-kind-icon">@webda/workout</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
		<div class="col-content">
			<h1>Store</h1>
			<div class="tsd-panel tsd-typography">
				<p>The store services allow you to store object in a NoSQL database it handles for you mapping between objects, have a security policy and check the object with JSON Schema</p>
				<p>We have currently File, DynamoDB and MongoDB storage</p>
				<a href="#expose-rest-api" id="expose-rest-api" style="color: inherit; text-decoration: none;">
					<h2>Expose REST API</h2>
				</a>
				<p>Inside the configuration you can add a block for expose the store as a REST API</p>
				<pre><code class="language-javascript"><span style="color: #000000">{</span>
<span style="color: #000000">  ...</span>
<span style="color: #000000">  </span><span style="color: #A31515">&quot;expose&quot;</span><span style="color: #000000">: {</span>
<span style="color: #000000">     </span><span style="color: #A31515">&quot;url&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;/storeurl&quot;</span><span style="color: #000000">, </span><span style="color: #008000">// By default the URL is the store name in lower case</span>
<span style="color: #000000">     </span><span style="color: #A31515">&quot;restrict&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> {</span>
<span style="color: #000000">       </span><span style="color: #A31515">&quot;update&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span><span style="color: #000000">, </span><span style="color: #008000">// Prevent the creation of an object the PUT method wont be exposed</span>
<span style="color: #000000">       </span><span style="color: #A31515">&quot;delete&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #0000FF">false</span><span style="color: #000000"> </span><span style="color: #008000">// Allow delete for the object</span>
<span style="color: #000000">     }</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">  ...</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>The above configuration will end up creating the following routes:</p>
				<p>POST /storeurl
					GET /storeurl/{uuid}
				DELETE /storeurl/{uuid}</p>
				<p>You can see that by default, once the store exposed all the methods are available unless you restrict them.</p>
				<a href="#configuring-mapping" id="configuring-mapping" style="color: inherit; text-decoration: none;">
					<h2>Configuring Mapping</h2>
				</a>
				<p>As an example we will use the Users / Idents stores used by the Authentication module.</p>
				<p>A User has several Idents so in NoSQL we need to deduplicate a part of the Ident object inside an array inside the User object</p>
				<p>The following is the Idents store configuration</p>
				<pre><code class="language-javascript"><span style="color: #000000">{</span>
<span style="color: #000000">  ...</span>
<span style="color: #000000">  </span><span style="color: #A31515">&quot;map&quot;</span><span style="color: #000000">: {</span>
<span style="color: #000000">     </span><span style="color: #A31515">&quot;Users&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> { </span><span style="color: #008000">// Target store</span>
<span style="color: #000000">        </span><span style="color: #A31515">&quot;key&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;user&quot;</span><span style="color: #000000">, </span><span style="color: #008000">// Property inside Ident Object</span>
<span style="color: #000000">        </span><span style="color: #A31515">&quot;target&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;idents&quot;</span><span style="color: #000000">, </span><span style="color: #008000">// Property on the User Object</span>
<span style="color: #000000">        </span><span style="color: #A31515">&quot;fields&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;type&quot;</span><span style="color: #000000">, </span><span style="color: #008000">// Fields from the Ident Object ( uuid is added by default )</span>
<span style="color: #000000">        </span><span style="color: #A31515">&quot;cascade&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span><span style="color: #000000"> </span><span style="color: #008000">// If User object is delete then delete all the linked Idents</span>
<span style="color: #000000">     }</span>
<span style="color: #000000">  }</span>
</code></pre>
				<p>So if you have a user like </p>
				<pre><code class="language-javascript"><span style="color: #000000">{</span>
<span style="color: #000000">  ...</span>
<span style="color: #000000">  </span><span style="color: #A31515">&quot;uuid&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;user_01&quot;</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>Then you save a new Ident object like</p>
				<pre><code class="language-javascript"><span style="color: #000000">{</span>
<span style="color: #000000">  ...</span>
<span style="color: #000000">  </span><span style="color: #A31515">&quot;uuid&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ident_01&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #A31515">&quot;user&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;user_01&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #A31515">&quot;type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Google&quot;</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>Once the Ident saved, the User object will look like</p>
				<pre><code class="language-javascript"><span style="color: #000000">{</span>
<span style="color: #000000">  ...</span>
<span style="color: #000000">  </span><span style="color: #A31515">&quot;uuid&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;user_01&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #A31515">&quot;idents&quot;</span><span style="color: #000000">: [{</span><span style="color: #A31515">&quot;uuid&quot;</span><span style="color: #001080">:</span><span style="color: #A31515">&quot;ident_01&quot;</span><span style="color: #000000">,</span><span style="color: #A31515">&quot;type&quot;</span><span style="color: #001080">:</span><span style="color: #A31515">&quot;Google&quot;</span><span style="color: #000000">}]</span>
<span style="color: #000000">  ...</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>Then if you update the field type on your Ident object the User object will reflect the change, as well as if you delete the ident object it will be removed from the User object.</p>
				<p>If cascade = true, then if you delete the User object, all attached Idents will be delete aswell.</p>
				<a href="#events" id="events" style="color: inherit; text-decoration: none;">
					<h2>Events</h2>
				</a>
				<p>The Stores emit events to let you implement some auto completion of the object if needed or taking any others action even deny the action by throwing an exception</p>
				<p>The store event looks like </p>
				<pre><code class="language-javascript"><span style="color: #000000">{</span>
<span style="color: #000000">  </span><span style="color: #A31515">&#039;object&#039;</span><span style="color: #000000">: </span><span style="color: #001080">object</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #A31515">&#039;store&#039;</span><span style="color: #000000">: </span><span style="color: #0000FF">this</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>Store.Save: Before saving the object
					Store.Saved: After saving the object
					Store.Update: Before updating the object
					Store.Updated: After updating the object
					Store.Delete: Before deleting the object
					Store.Deleted: After deleting the object
				Store.Get: When getting the object</p>
				<a href="#security-policy" id="security-policy" style="color: inherit; text-decoration: none;">
					<h2>Security Policy</h2>
				</a>
				<p>The security policy will be called on any REST API called from the Store, the internal method to access the objects are not secured with it yet, we might later on add this feature.
				The security policy could also be implemented by a Service that listen on Store event this way you can enforce the security even internally</p>
				<pre><code class="language-javascript"><span style="color: #000000">{</span>
<span style="color: #000000">  ...</span>
<span style="color: #000000">  </span><span style="color: #A31515">&quot;security&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OwnerPolicy&quot;</span><span style="color: #000000"> </span><span style="color: #008000">// This is the default SecurityPolicy</span>
<span style="color: #000000">  ...</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>If not specified the Store will pick the Owner policy as default.
				Policies are implicit service, so you can get them with a getService(&quot;OwnerPolicy&quot;), but don&#39;t appear by default in the configuration file. That also means you can override a Policy if you want or create your own to implement your business model</p>
				<a href="#owner-policy" id="owner-policy" style="color: inherit; text-decoration: none;">
					<h3>Owner Policy</h3>
				</a>
				<p>POST: Add the current user in the user field of the object
					PUT: Verify the current user is the user inside the user field
					GET: Verify the current user is the user inside the user field, or a public=true field exists on the object
				DELETE: Verify the current user is the user inside the user field</p>
				<a href="#void-policy" id="void-policy" style="color: inherit; text-decoration: none;">
					<h3>Void policy</h3>
				</a>
				<p>No verification, not recommended at all</p>
				<a href="#validation" id="validation" style="color: inherit; text-decoration: none;">
					<h2>Validation</h2>
				</a>
				<p>To ensure that the input is correct, you can setup a JSON schema this way any update or creation will verify that the object is correct.</p>
				<pre><code class="language-javascript"><span style="color: #000000">{</span>
<span style="color: #000000">  ...</span>
<span style="color: #000000">  </span><span style="color: #A31515">&quot;validator&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;schema&quot;</span>
<span style="color: #000000">  ...</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>All the input of POST or PUT will then be validate against it.</p>
				<a href="#dynamodb-configuration" id="dynamodb-configuration" style="color: inherit; text-decoration: none;">
					<h2>DynamoDB configuration</h2>
				</a>
				<p>The DynamoDB stores requires at least accessKeyId, secretAccessKey and table</p>
				<p>For more information on DynamoDB : <a href="https://aws.amazon.com/dynamodb/">AWS DynamoDB</a></p>
				<a href="#mongodb-configuration" id="mongodb-configuration" style="color: inherit; text-decoration: none;">
					<h2>MongoDB configuration</h2>
				</a>
				<p>The MongoDB configuration requires a collection and a mongo parameter where mongo is the MongoDB url</p>
				<a href="#filedb-configuration" id="filedb-configuration" style="color: inherit; text-decoration: none;">
					<h2>FileDB configuration</h2>
				</a>
				<p>The FileDB only requires a folder where to store the datas. It creates it if not exists</p>
			</div>
			<!--{&quot;options&quot;:&quot;/datas/git/webda.io&quot;,&quot;tsconfig&quot;:&quot;/datas/git/webda.io&quot;,&quot;packages&quot;:[&quot;/datas/git/webda.io&quot;],&quot;entryPoints&quot;:[],&quot;exclude&quot;:[&quot;**/node_modules&quot;,&quot;/datas/git/webda.io/packages/*/node_modules&quot;,&quot;/datas/git/webda.io/packages/*/src/**/*.spec.ts&quot;,&quot;/datas/git/webda.io/sample-app&quot;],&quot;externalPattern&quot;:[&quot;**/node_modules/**&quot;],&quot;excludeExternals&quot;:true,&quot;excludeNotDocumented&quot;:false,&quot;excludeInternal&quot;:false,&quot;excludePrivate&quot;:true,&quot;excludeProtected&quot;:false,&quot;disableSources&quot;:false,&quot;includes&quot;:&quot;&quot;,&quot;media&quot;:&quot;/datas/git/webda.io/docs/media&quot;,&quot;watch&quot;:false,&quot;preserveWatchOutput&quot;:false,&quot;emit&quot;:false,&quot;out&quot;:&quot;/datas/git/webda.io/docs/typedoc&quot;,&quot;json&quot;:&quot;&quot;,&quot;pretty&quot;:true,&quot;theme&quot;:&quot;./node_modules/typedoc-loopingz-theme/bin/default&quot;,&quot;highlightTheme&quot;:&quot;light-plus&quot;,&quot;name&quot;:&quot;webda.io&quot;,&quot;includeVersion&quot;:true,&quot;excludeTags&quot;:[],&quot;readme&quot;:&quot;/datas/git/webda.io/readme.md&quot;,&quot;defaultCategory&quot;:&quot;Other&quot;,&quot;categoryOrder&quot;:[],&quot;categorizeByGroup&quot;:true,&quot;sort&quot;:[&quot;kind&quot;,&quot;instance-first&quot;,&quot;alphabetical&quot;],&quot;gitRevision&quot;:&quot;&quot;,&quot;gitRemote&quot;:&quot;origin&quot;,&quot;gaID&quot;:&quot;&quot;,&quot;gaSite&quot;:&quot;auto&quot;,&quot;hideGenerator&quot;:false,&quot;toc&quot;:[],&quot;disableOutputCheck&quot;:false,&quot;help&quot;:false,&quot;version&quot;:false,&quot;showConfig&quot;:false,&quot;plugin&quot;:[],&quot;logger&quot;:&quot;console&quot;,&quot;logLevel&quot;:1,&quot;treatWarningsAsErrors&quot;:false,&quot;listInvalidSymbolLinks&quot;:false,&quot;outline&quot;:[],&quot;excludeReferences&quot;:false,&quot;pages&quot;:{&quot;source&quot;:&quot;./docs/pages/&quot;,&quot;replaceGlobalsPage&quot;:true,&quot;reflectionNavigationTitle&quot;:&quot;Modules&quot;,&quot;autoDetectPageTitle&quot;:true,&quot;autoPopulateChildren&quot;:true,&quot;noJekyll&quot;:true,&quot;githubPagesDomain&quot;:&quot;docs.webda.io&quot;,&quot;enablePageLinks&quot;:true,&quot;enableSearch&quot;:true,&quot;failBuildOnInvalidPageLink&quot;:false,&quot;listInvalidPageLinks&quot;:false,&quot;output&quot;:&quot;pages&quot;,&quot;sources&quot;:[&quot;./docs/pages/&quot;]}}-->
			<footer class="with-border-bottom">
			</footer>
			<div class="container tsd-generator">
				<p>Generated using <a href="http://typedoc.org/" target="_blank">TypeDoc</a></p>
			</div>
		</div>
	</div>
</div>
</div>
<div class="overlay"></div>
<script src="../../assets/js/main.js"></script>
<script
src="https://unpkg.com/mermaid/dist/mermaid.min.js"
></script>
<script>
    mermaid.initialize({
      startOnLoad: true,
    });
    </script>
</body>
</html>